
USE SHOP_DONG_HO;

CREATE TABLE Admin (
    MaAdmin INT PRIMARY KEY AUTO_INCREMENT,
    TenDangNhap VARCHAR(50) UNIQUE,
    MatKhau VARCHAR(255),
    HoTen VARCHAR(100),
    Email VARCHAR(100),
    VaiTro VARCHAR(50) DEFAULT 'Admin',
    NgayTao DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE KhachHang (
    MaKH INT PRIMARY KEY AUTO_INCREMENT,
    HoTen VARCHAR(100),
    Email VARCHAR(100) UNIQUE,
    MatKhau VARCHAR(255),
    SoDienThoai VARCHAR(15),
    DiaChi TEXT,
    NgayTao DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE DanhMuc (
    MaDanhMuc INT PRIMARY KEY AUTO_INCREMENT,
    TenDanhMuc VARCHAR(100),
    MoTa TEXT
);

CREATE TABLE SanPham (
    MaSP INT PRIMARY KEY AUTO_INCREMENT,
    TenSP VARCHAR(150),
    MaDanhMuc INT,
    ThuongHieu VARCHAR(100),
    Gia DECIMAL(10,2),
    MoTa TEXT,
    HinhAnh VARCHAR(255),
    SoLuongTon INT,
    NgayTao DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (MaDanhMuc) REFERENCES DanhMuc(MaDanhMuc)
);

CREATE TABLE KhuyenMai (
    MaKM INT PRIMARY KEY AUTO_INCREMENT,
    MaCode VARCHAR(50) UNIQUE,
    MoTa TEXT,
    ChietKhauPhanTram DECIMAL(5,2),
    NgayBatDau DATE,
    NgayKetThuc DATE,
    KichHoat BOOLEAN DEFAULT TRUE
);

CREATE TABLE VanChuyen (
    MaVC INT PRIMARY KEY AUTO_INCREMENT,
    TenPhuongThuc VARCHAR(100),
    PhiVanChuyen DECIMAL(10,2),
    SoNgayDuKien INT
);

CREATE TABLE DonHang (
    MaDH INT PRIMARY KEY AUTO_INCREMENT,
    MaKH INT,
    NgayDat DATETIME DEFAULT CURRENT_TIMESTAMP,
    TongTien DECIMAL(10,2),
    TrangThai VARCHAR(50) DEFAULT 'Chờ xử lý',
    MaKM INT,
    MaVC INT,
    FOREIGN KEY (MaKH) REFERENCES KhachHang(MaKH),
    FOREIGN KEY (MaKM) REFERENCES KhuyenMai(MaKM),
    FOREIGN KEY (MaVC) REFERENCES VanChuyen(MaVC)
);

CREATE TABLE ChiTietDonHang (
    MaCTDH INT PRIMARY KEY AUTO_INCREMENT,
    MaDH INT,
    MaSP INT,
    SoLuong INT,
    DonGia DECIMAL(10,2),
    ThanhTien DECIMAL(10,2) GENERATED ALWAYS AS (SoLuong * DonGia) STORED,
    FOREIGN KEY (MaDH) REFERENCES DonHang(MaDH),
    FOREIGN KEY (MaSP) REFERENCES SanPham(MaSP)
);

CREATE TABLE GioHang (
    MaGio INT PRIMARY KEY AUTO_INCREMENT,
    MaKH INT,
    MaSP INT,
    SoLuong INT,
    NgayThem DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (MaKH) REFERENCES KhachHang(MaKH),
    FOREIGN KEY (MaSP) REFERENCES SanPham(MaSP)
);

CREATE TABLE ThanhToan (
    MaTT INT PRIMARY KEY AUTO_INCREMENT,
    MaDH INT,
    PhuongThucTT VARCHAR(50),
    NgayThanhToan DATETIME DEFAULT CURRENT_TIMESTAMP,
    SoTien DECIMAL(10,2),
    TrangThaiTT VARCHAR(50) DEFAULT 'Chưa thanh toán',
    FOREIGN KEY (MaDH) REFERENCES DonHang(MaDH)
);
